<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHRIMPTECH Email Debug</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 20px auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .debug-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { 
            background: #0066cc; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover { background: #0052a3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        textarea, input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        .log { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 15px; 
            border-radius: 5px; 
            font-family: monospace; 
            max-height: 400px; 
            overflow-y: auto;
            white-space: pre-wrap;
        }
        h1 { color: #0066cc; text-align: center; }
        h2 { color: #0066cc; border-bottom: 2px solid #0066cc; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü¶ê SHRIMPTECH Email Debug Tool</h1>
        <p style="text-align: center; color: #666;">Tool ƒë·ªÉ debug v√† test h·ªá th·ªëng email</p>
        
        <div class="debug-section info">
            <h2>üîç System Status</h2>
            <div id="systemStatus">ƒêang ki·ªÉm tra...</div>
            <button onclick="checkSystemStatus()">Refresh Status</button>
        </div>

        <div class="debug-section">
            <h2>üß™ Test Email Server</h2>
            <button onclick="testEmailServer()">Test SMTP Connection</button>
            <button onclick="sendTestEmail()">Send Test Email</button>
            <div id="testResults" class="log"></div>
        </div>

        <div class="debug-section">
            <h2>üìß Test Contact Form</h2>
            <form id="debugContactForm">
                <input type="text" name="name" placeholder="T√™n" value="Test User" required>
                <input type="email" name="email" placeholder="Email" value="test@example.com" required>
                <input type="tel" name="phone" placeholder="ƒêi·ªán tho·∫°i" value="0835749407" required>
                <input type="text" name="company" placeholder="C√¥ng ty" value="Test Company">
                <select name="farmType">
                    <option value="">Ch·ªçn lo·∫°i ao</option>
                    <option value="pond-small" selected>Ao tr√≤n n·ªïi (50-700m¬≤)</option>
                    <option value="pond-medium">Ao l√≥t b·∫°t ƒë√°y (700‚Äì1.000m¬≤)</option>
                    <option value="pond-large">Ao si√™u th√¢m canh (1.000‚Äì3.000m¬≤)</option>
                </select>
                <select name="subject">
                    <option value="">Ch·ªçn ch·ªß ƒë·ªÅ</option>
                    <option value="product-info" selected>Th√¥ng tin s·∫£n ph·∫©m</option>
                    <option value="consultation">T∆∞ v·∫•n h·ªá th·ªëng</option>
                    <option value="technical">T∆∞ v·∫•n k·ªπ thu·∫≠t</option>
                </select>
                <textarea name="message" placeholder="N·ªôi dung tin nh·∫Øn" rows="4">ƒê√¢y l√† tin nh·∫Øn test t·ª´ debug tool c·ªßa SHRIMPTECH.</textarea>
                <label><input type="checkbox" name="newsletter"> ƒêƒÉng k√Ω newsletter</label>
                <br><br>
                <button type="submit">Send Contact Form</button>
            </form>
            <div id="contactResults" class="log"></div>
        </div>

        <div class="debug-section">
            <h2>üìÑ Console Logs</h2>
            <button onclick="clearLogs()">Clear Logs</button>
            <div id="consoleLogs" class="log"></div>
        </div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function logToDiv(type, args) {
            const logDiv = document.getElementById('consoleLogs');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg).join(' ');
            
            logDiv.innerHTML += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToDiv('log', args);
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToDiv('error', args);
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToDiv('warn', args);
        };

        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = 'ƒêang ki·ªÉm tra...';
            
            const checks = {
                'Backend Handler': typeof window.shrimpTechBackend !== 'undefined',
                'Email Service': typeof window.EmailService !== 'undefined',
                'Form Handler': typeof window.FormHandler !== 'undefined'
            };
            
            let statusHTML = '<ul>';
            for (const [check, status] of Object.entries(checks)) {
                const icon = status ? '‚úÖ' : '‚ùå';
                statusHTML += `<li>${icon} ${check}: ${status ? 'Available' : 'Not Available'}</li>`;
            }
            statusHTML += '</ul>';
            
            // Test API endpoints
            statusHTML += '<h3>API Endpoints:</h3><ul>';
            const endpoints = [
                'http://localhost:3001/api/status',
                'http://127.0.0.1:3001/api/status',
                '/api/status'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const icon = response.ok ? '‚úÖ' : '‚ùå';
                    statusHTML += `<li>${icon} ${endpoint}: ${response.status}</li>`;
                } catch (error) {
                    statusHTML += `<li>‚ùå ${endpoint}: Connection failed</li>`;
                }
            }
            statusHTML += '</ul>';
            
            statusDiv.innerHTML = statusHTML;
        }

        async function testEmailServer() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = 'Testing SMTP connection...\n';
            
            const endpoints = [
                'http://localhost:3001/api/test-email',
                'http://127.0.0.1:3001/api/test-email',
                '/api/test-email'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    resultsDiv.innerHTML += `Trying ${endpoint}...\n`;
                    
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        resultsDiv.innerHTML += `‚úÖ SUCCESS: ${result.message}\n`;
                        return;
                    } else {
                        resultsDiv.innerHTML += `‚ùå ERROR: ${result.message}\n`;
                    }
                } catch (error) {
                    resultsDiv.innerHTML += `‚ùå CONNECTION ERROR: ${error.message}\n`;
                }
            }
        }

        async function sendTestEmail() {
            await testEmailServer();
        }

        document.getElementById('debugContactForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultsDiv = document.getElementById('contactResults');
            resultsDiv.innerHTML = 'Sending contact form...\n';
            
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                company: formData.get('company'),
                farmType: formData.get('farmType'),
                subject: formData.get('subject'),
                message: formData.get('message'),
                newsletter: formData.get('newsletter') === 'on'
            };
            
            console.log('Sending contact form data:', data);
            
            // Test with backend handler first
            if (window.shrimpTechBackend) {
                try {
                    resultsDiv.innerHTML += 'Trying backend handler...\n';
                    const result = await window.shrimpTechBackend.handleContactForm(data);
                    resultsDiv.innerHTML += `‚úÖ Backend Handler SUCCESS: ${result.message}\n`;
                    return;
                } catch (error) {
                    resultsDiv.innerHTML += `‚ùå Backend Handler ERROR: ${error.message}\n`;
                }
            }
            
            // Test direct API calls
            const endpoints = [
                'http://localhost:3001/api/contact',
                'http://127.0.0.1:3001/api/contact',
                '/api/contact'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    resultsDiv.innerHTML += `Trying direct API: ${endpoint}...\n`;
                    
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        resultsDiv.innerHTML += `‚úÖ Direct API SUCCESS: ${result.message}\n`;
                        return;
                    } else {
                        resultsDiv.innerHTML += `‚ùå Direct API ERROR: ${result.message}\n`;
                    }
                } catch (error) {
                    resultsDiv.innerHTML += `‚ùå API CONNECTION ERROR: ${error.message}\n`;
                }
            }
        });

        function clearLogs() {
            document.getElementById('consoleLogs').innerHTML = '';
        }

        // Initialize
        checkSystemStatus();
    </script>

    <!-- Load the same scripts as the main site -->
    <script src="../js/utils.js"></script>
    <script src="../js/email-service.js"></script>
    <script src="../js/backend-handler.js"></script>
    <script src="../js/form-handler.js"></script>
</body>
</html>
